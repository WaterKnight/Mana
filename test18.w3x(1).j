globalstrigger e=nullreal i=0.real a=0.boolexpr E=nullendglobalsfunction O takes nothing returns booleanlocal real dx=GetDestructableX(GetFilterDestructable())-ilocal real dy=GetDestructableY(GetFilterDestructable())-areturn(dx*dx+dy*dy<=bj_enumDestructableRadius)endfunctionfunction R takes itemtype I,integer A returns nothinglocal group gset bj_stockPickedItemType=Iset bj_stockPickedItemLevel=Aset g=CreateGroup()call GroupEnumUnitsOfType(g,"marketplace",E)call ForGroup(g,function UpdateEachStockBuildingEnum)call DestroyGroup(g)set g=nullendfunctionfunction N takes nothing returns nothinglocal integer pickedItemIdlocal itemtype blocal integer B=0local integer c=0local integer Aset A=1loopif(bj_stockAllowedPermanent[A])thenset c=c+1if(GetRandomInt(1,c)==1)thenset b=ITEM_TYPE_PERMANENTset B=Aendifendifif(bj_stockAllowedCharged[A])thenset c=c+1if(GetRandomInt(1,c)==1)thenset b=ITEM_TYPE_CHARGEDset B=Aendifendifif(bj_stockAllowedArtifact[A])thenset c=c+1if(GetRandomInt(1,c)==1)thenset b=ITEM_TYPE_ARTIFACTset B=Aendifendifset A=A+1exitwhen A>bj_MAX_ITEM_LEVELendloopif(c==0)thenset b=nullreturnendifcall R(b,B)set b=nullendfunctionfunction C takes nothing returns nothingcall N()call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INTERVAL,true,function N)endfunctionfunction d takes nothing returns nothinglocal integer Aset A=0loopset bj_stockAllowedPermanent[A]=falseset bj_stockAllowedCharged[A]=falseset bj_stockAllowedArtifact[A]=falseset A=A+1exitwhen A>bj_MAX_ITEM_LEVELendloopcall SetAllItemTypeSlots(bj_MAX_STOCK_ITEM_SLOTS)call SetAllUnitTypeSlots(bj_MAX_STOCK_UNIT_SLOTS)set bj_stockUpdateTimer=CreateTimer()call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INITIAL_DELAY,false,function C)set bj_stockItemPurchased=CreateTrigger()call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased,Player(PLAYER_NEUTRAL_PASSIVE),EVENT_PLAYER_UNIT_SELL_ITEM,null)call TriggerAddAction(bj_stockItemPurchased,function RemovePurchasedItem)endfunctionfunction D takes nothing returns booleanreturn trueendfunctionfunction f takes nothing returns nothinglocal integer Flocal integer Glocal version vset E=Filter(function D)set filterIssueHauntOrderAtLocBJ=Filter(function IssueHauntOrderAtLocBJFilter)set filterEnumDestructablesInCircleBJ=Filter(function O)set filterGetUnitsInRectOfPlayer=Filter(function GetUnitsInRectOfPlayerFilter)set filterGetUnitsOfTypeIdAll=Filter(function GetUnitsOfTypeIdAllFilter)set filterGetUnitsOfPlayerAndTypeId=Filter(function GetUnitsOfPlayerAndTypeIdFilter)set filterMeleeTrainedUnitIsHeroBJ=Filter(function MeleeTrainedUnitIsHeroBJFilter)set filterLivingPlayerUnitsOfTypeId=Filter(function LivingPlayerUnitsOfTypeIdFilter)set F=0loopexitwhen F==bj_MAX_PLAYER_SLOTSset bj_FORCE_PLAYER[F]=CreateForce()call ForceAddPlayer(bj_FORCE_PLAYER[F],Player(F))set F=F+1endloopset bj_FORCE_ALL_PLAYERS=CreateForce()call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS,null)set bj_cineModePriorSpeed=GetGameSpeed()set bj_cineModePriorFogSetting=IsFogEnabled()set bj_cineModePriorMaskSetting=IsFogMaskEnabled()set F=0loopexitwhen F>=bj_MAX_QUEUED_TRIGGERSset bj_queuedExecTriggers[F]=nullset bj_queuedExecUseConds[F]=falseset F=F+1endloopset bj_isSinglePlayer=falseset G=0set F=0loopexitwhen F>=bj_MAX_PLAYERSif(GetPlayerController(Player(F))==MAP_CONTROL_USER and GetPlayerSlotState(Player(F))==PLAYER_SLOT_STATE_PLAYING)thenset G=G+1endifset F=F+1endloopset bj_isSinglePlayer=(G==1)set bj_rescueSound=CreateSoundFromLabel("Rescue",false,false,false,10000,10000)set bj_questDiscoveredSound=CreateSoundFromLabel("QuestNew",false,false,false,10000,10000)set bj_questUpdatedSound=CreateSoundFromLabel("QuestUpdate",false,false,false,10000,10000)set bj_questCompletedSound=CreateSoundFromLabel("QuestCompleted",false,false,false,10000,10000)set bj_questFailedSound=CreateSoundFromLabel("QuestFailed",false,false,false,10000,10000)set bj_questHintSound=CreateSoundFromLabel("Hint",false,false,false,10000,10000)set bj_questSecretSound=CreateSoundFromLabel("SecretFound",false,false,false,10000,10000)set bj_questItemAcquiredSound=CreateSoundFromLabel("ItemReward",false,false,false,10000,10000)set bj_questWarningSound=CreateSoundFromLabel("Warning",false,false,false,10000,10000)set bj_victoryDialogSound=CreateSoundFromLabel("QuestCompleted",false,false,false,10000,10000)set bj_defeatDialogSound=CreateSoundFromLabel("QuestFailed",false,false,false,10000,10000)call DelayedSuspendDecayCreate()set v=VersionGet()if(v==VERSION_REIGN_OF_CHAOS)thenset bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V0elseset bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V1endifendfunctionfunction h takes nothing returns nothingcall ConfigureNeutralVictim()call f()call InitQueuedTriggers()call InitRescuableBehaviorBJ()call InitDNCSounds()call InitMapRects()call InitSummonableCaps()call d()call DetectGameStarted()endfunctionfunction H takes nothing returns nothingendfunctionfunction j takes nothing returns nothinglocal integer itemIDcall CreateItem('I004',11.0,-98.3)call CreateItem('I00B',209.5,-689.5)call CreateItem('I01D',30.3,-633.6)call CreateItem('I01V',126.0,-667.0)endfunctionfunction J takes nothing returns nothinglocal player p=Player(0)local unit ulocal integer unitIDlocal trigger tlocal real lifeset u=CreateUnit(p,'Hpal',78.8,23.5,62.448)endfunctionfunction k takes nothing returns nothingendfunctionfunction K takes nothing returns nothingcall J()endfunctionfunction l takes nothing returns nothingcall k()call K()endfunctionfunction L takes nothing returns nothingcall MeleeStartingVisibility()call MeleeStartingHeroLimit()call MeleeGrantHeroItems()call MeleeStartingResources()call MeleeClearExcessUnits()call MeleeStartingUnits()call MeleeStartingAI()call MeleeInitVictoryDefeat()endfunctionfunction m takes nothing returns nothingset e=CreateTrigger()call TriggerAddAction(e,function L)endfunctionfunction M takes nothing returns nothingcall m()endfunctionfunction P takes nothing returns nothingcall ConditionalTriggerExecute(e)endfunctionfunction q takes nothing returns nothingcall SetPlayerStartLocation(Player(0),0)call SetPlayerColor(Player(0),ConvertPlayerColor(0))call SetPlayerRacePreference(Player(0),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(0),true)call SetPlayerController(Player(0),MAP_CONTROL_USER)endfunctionfunction InitCustomTeams takes nothing returns nothingcall SetPlayerTeam(Player(0),0)endfunctionfunction main takes nothing returns nothingcall SetCameraBounds(-3328.0+GetCameraMargin(CAMERA_MARGIN_LEFT),-3584.0+GetCameraMargin(CAMERA_MARGIN_BOTTOM),3328.0-GetCameraMargin(CAMERA_MARGIN_RIGHT),3072.0-GetCameraMargin(CAMERA_MARGIN_TOP),-3328.0+GetCameraMargin(CAMERA_MARGIN_LEFT),3072.0-GetCameraMargin(CAMERA_MARGIN_TOP),3328.0-GetCameraMargin(CAMERA_MARGIN_RIGHT),-3584.0+GetCameraMargin(CAMERA_MARGIN_BOTTOM))call SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl","Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")call NewSoundEnvironment("Default")call SetAmbientDaySound("LordaeronSummerDay")call SetAmbientNightSound("LordaeronSummerNight")call SetMapMusic("Music",true,0)call j()call l()call h()call H()call M()call P()endfunctionfunction config takes nothing returns nothingcall SetMapName("Noch eine WARCRAFT-III-Karte")call SetMapDescription("Unbeschrieben")call SetPlayers(1)call SetTeams(1)call SetGamePlacement(MAP_PLACEMENT_USE_MAP_SETTINGS)call DefineStartLocation(0,1344.0,-64.0)call q()call SetPlayerSlotAvailable(Player(0),MAP_CONTROL_USER)call InitGenericPlayerSlots()endfunction